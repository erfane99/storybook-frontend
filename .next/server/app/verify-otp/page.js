(()=>{var e={};e.id=162,e.ids=[162],e.modules={3244:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=3244,e.exports=t},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},3994:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>l,routeModule:()=>m,tree:()=>c}),r(3184),r(5931),r(5866);var s=r(3191),i=r(8716),o=r(7922),a=r.n(o),n=r(5231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);r.d(t,d);let c=["",{children:["verify-otp",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3184)),"/home/project/app/verify-otp/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,5931)),"/home/project/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],l=["/home/project/app/verify-otp/page.tsx"],u="/verify-otp/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/verify-otp/page",pathname:"/verify-otp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4698:(e,t,r)=>{Promise.resolve().then(r.bind(r,9859))},9859:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(326),i=r(7577),o=r(5047),a=r(4723),n=r(772),d=r(4432),c=r(1048),l=r(2643),u=r(4215),p=r(165),m=r(7506),f=r(6333),h=r(2945),x=r(6824);function y(){let[e,t]=(0,i.useState)(!1),[r,y]=(0,i.useState)(!1),[g,b]=(0,i.useState)(0),v=(0,o.useRouter)(),j=(0,o.useSearchParams)(),{toast:N}=(0,u.pm)(),S=j.get("phone"),P=(0,h.x)(),{register:w,handleSubmit:O,formState:{errors:T},watch:_}=(0,a.cI)(),k=_("otp_code"),I=async e=>{if(S){t(!0);try{await x.hi.verifyOTP(S,e.otp_code);try{let{data:{session:e},error:t}=await P.auth.getSession();if(t)throw console.error("Session error:",t),Error("Failed to get user session");if(e?.user){let{data:t,error:r}=await P.from("profiles").select("user_id").eq("user_id",e.user.id).single();if(r&&"PGRST116"===r.code){let t=new Date().toISOString(),{error:r}=await P.from("profiles").insert({user_id:e.user.id,email:S,user_type:"user",full_name:"",avatar_url:"",created_at:t,updated_at:t}).single();r?(console.error("Error creating user profile:",r),N({variant:"destructive",title:"Profile Creation Warning",description:"Account verified but profile setup incomplete. Please contact support if issues persist."})):console.log("✅ User profile created successfully")}else r?(console.error("Error checking user profile:",r),N({variant:"destructive",title:"Profile Check Warning",description:"Account verified but profile check failed. Please contact support if issues persist."})):console.log("✅ User profile already exists")}else console.warn("No user session found after OTP verification")}catch(e){console.error("Profile handling error:",e),N({variant:"destructive",title:"Profile Setup Warning",description:"Account verified but profile setup incomplete. You can continue using the app."})}N({title:"Success",description:"Phone number verified successfully!"}),v.push("/")}catch(e){N({variant:"destructive",title:"Verification Failed",description:e.message||"Invalid verification code"})}finally{t(!1)}}},q=async()=>{if(S&&!(g>0)){y(!0);try{await x.hi.sendOTP(S),N({title:"OTP Resent",description:"A new verification code has been sent to your phone."}),b(30)}catch(e){N({variant:"destructive",title:"Error",description:e.message||"Failed to resend OTP"})}finally{y(!1)}}};if(!S)return null;let C=0===g&&!r;return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,s.jsxs)(l.Zb,{className:"w-full max-w-md",children:[(0,s.jsxs)(l.Ol,{className:"text-center",children:[s.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:s.jsx(p.Z,{className:"h-6 w-6 text-primary"})}),s.jsx(l.ll,{className:"text-2xl font-bold",children:"Verify Your Phone"}),(0,s.jsxs)(l.SZ,{children:["Enter the 6-digit code sent to"," ",s.jsx("span",{className:"font-medium",children:S})]})]}),(0,s.jsxs)(l.aY,{children:[(0,s.jsxs)("form",{onSubmit:O(I),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(c._,{htmlFor:"otp_code",children:"Verification Code"}),s.jsx(d.I,{id:"otp_code",type:"text",placeholder:"123456",maxLength:6,...w("otp_code",{required:"Verification code is required",pattern:{value:/^\d{6}$/,message:"Please enter a valid 6-digit code"}}),disabled:e,className:"text-center text-2xl tracking-widest font-mono",autoComplete:"one-time-code",autoFocus:!0}),T.otp_code&&s.jsx("p",{className:"text-sm text-destructive",children:T.otp_code.message}),s.jsx("p",{className:"text-xs text-muted-foreground text-center",children:k&&6===k.length&&!e?"Auto-submitting...":"Code will auto-submit when complete"})]}),s.jsx(n.z,{type:"submit",className:"w-full",disabled:e||!k||6!==k.length,children:e?(0,s.jsxs)(s.Fragment,{children:[s.jsx(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Verifying..."]}):"Verify OTP"})]}),(0,s.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Didn't receive the code?"}),s.jsx(n.z,{variant:"outline",onClick:q,disabled:!C,className:"w-full",children:r?(0,s.jsxs)(s.Fragment,{children:[s.jsx(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Resending..."]}):"Resend Code"}),g>0&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["You can resend the code in ",g,"s"]})]}),s.jsx("div",{className:"text-center",children:(0,s.jsxs)(n.z,{variant:"ghost",onClick:()=>v.push("/auth"),className:"text-sm",children:[s.jsx(f.Z,{className:"mr-2 h-4 w-4"}),"Back to Sign In"]})})]})]})]})})}function g(){return s.jsx(i.Suspense,{fallback:s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx(m.Z,{className:"h-8 w-8 animate-spin"})}),children:s.jsx(y,{})})}},2643:(e,t,r)=>{"use strict";r.d(t,{Ol:()=>n,SZ:()=>c,Zb:()=>a,aY:()=>l,eW:()=>u,ll:()=>d});var s=r(326),i=r(7577),o=r(7863);let a=i.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));a.displayName="Card";let n=i.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",e),...t}));n.displayName="CardHeader";let d=i.forwardRef(({className:e,...t},r)=>s.jsx("h3",{ref:r,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));d.displayName="CardTitle";let c=i.forwardRef(({className:e,...t},r)=>s.jsx("p",{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",e),...t}));c.displayName="CardDescription";let l=i.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,o.cn)("p-6 pt-0",e),...t}));l.displayName="CardContent";let u=i.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,o.cn)("flex items-center p-6 pt-0",e),...t}));u.displayName="CardFooter"},4432:(e,t,r)=>{"use strict";r.d(t,{I:()=>a});var s=r(326),i=r(7577),o=r(7863);let a=i.forwardRef(({className:e,type:t,...r},i)=>s.jsx("input",{type:t,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...r}));a.displayName="Input"},1048:(e,t,r)=>{"use strict";r.d(t,{_:()=>c});var s=r(326),i=r(7577),o=r(4478),a=r(9360),n=r(7863);let d=(0,a.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef(({className:e,...t},r)=>s.jsx(o.f,{ref:r,className:(0,n.cn)(d(),e),...t}));c.displayName=o.f.displayName},6824:(e,t,r)=>{"use strict";async function s(e,t={}){let r=function(e){let t=e.startsWith("/")?e.slice(1):e;return`https://storybook-backend-production-cb71.up.railway.app/${t}`}(e),s={headers:{"Content-Type":"application/json",...t.headers},...t};try{let e=await fetch(r,s);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||`HTTP ${e.status}: ${e.statusText}`)}return await e.json()}catch(t){throw console.error(`API request failed for ${e}:`,t),t}}r.d(t,{hi:()=>i});let i={sendOTP:e=>s("api/send-otp",{method:"POST",body:JSON.stringify({phone:e})}),verifyOTP:(e,t)=>s("api/verify-otp",{method:"POST",body:JSON.stringify({phone:e,otp_code:t})}),uploadImage:e=>s("api/upload-image",{method:"POST",body:e,headers:{}}),describeImage:e=>s("api/image/describe",{method:"POST",body:JSON.stringify({imageUrl:e})}),cartoonizeImage:(e,t,r)=>s("api/image/cartoonize",{method:"POST",body:JSON.stringify({prompt:e,style:t,imageUrl:r})}),generateScenes:(e,t,r)=>s("api/story/generate-scenes",{method:"POST",body:JSON.stringify({story:e,characterImage:t,audience:r})}),generateAutoStory:e=>s("api/story/generate-auto-story",{method:"POST",body:JSON.stringify(e)}),createStorybook:e=>s("api/story/create-storybook",{method:"POST",body:JSON.stringify(e)}),generateCartoonImage:e=>s("api/story/generate-cartoon-image",{method:"POST",body:JSON.stringify({image_prompt:e})}),getUserStorybooks:e=>s("api/story/get-user-storybooks",{headers:{Authorization:`Bearer ${e}`}}),getUserStorybookById:(e,t)=>s(`api/story/get-user-storybook-by-id?id=${e}`,{headers:{Authorization:`Bearer ${t}`}}),deleteStorybookById:(e,t)=>s(`api/story/delete-by-id?id=${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),requestPrint:(e,t)=>s("api/story/request-print",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({storybook_id:e})}),startAutoStoryJob:e=>s("api/jobs/auto-story/start",{method:"POST",body:JSON.stringify(e)}),startScenesJob:e=>s("api/jobs/scenes/start",{method:"POST",body:JSON.stringify(e)}),startStorybookJob:e=>s("api/jobs/storybook/start",{method:"POST",body:JSON.stringify(e)}),getUserJobs:e=>s("api/jobs/user",{headers:{Authorization:`Bearer ${e}`}}),cancelJob:e=>s(`api/jobs/cancel/${e}`,{method:"POST"}),deleteJob:(e,t)=>s(`api/jobs/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})}},2945:(e,t,r)=>{"use strict";r.d(t,{x:()=>o});var s=r(8655);let i=null;function o(){return i||(i=(0,s.AY)("https://nzkwrrinpweiqcnzeric.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56a3dycmlucHdlaXFjbnplcmljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MTE3NjYsImV4cCI6MjA2MjE4Nzc2Nn0.6KOABidPThLpLfw_YSKvK8YYwF1srRlaFyczTiRF0i8")),i}},6333:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},165:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},3184:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`/home/project/app/verify-otp/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[759,655,707,474],()=>r(3994));module.exports=s})();