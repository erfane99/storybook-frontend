(()=>{var e={};e.id=734;e.ids=[734];e.modules={288:(e,r,t)=>{"use strict";t.r(r);t.d(r,{"default":()=>l,metadata:()=>d});var o=t(2004);var n=t.n(o);var s=t(327);var i=t.n(s);var a=t(4925);var c=t.n(a);Object(function e(){var e=new Error("Cannot find module '@/lib/utils'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/app/_components/root-client-wrapper'");e.code="MODULE_NOT_FOUND";throw e}());const d={title:"StoryCanvas - AI Storybook Generator",description:"Create beautiful cartoon storybooks with AI using your own images",keywords:["AI","storybook","children","cartoon","generator","DALL-E","OpenAI"],viewport:"width=device-width, initial-scale=1, maximum-scale=1"};function l({children:e}){return(0,o.jsxs)("html",{lang:"en",suppressHydrationWarning:true,className:Object(function e(){var e=new Error("Cannot find module '@/lib/utils'");e.code="MODULE_NOT_FOUND";throw e}())("antialiased",c().variable),children:[(0,o.jsx)("head",{}),(0,o.jsx)("body",{className:"min-h-screen bg-background font-sans",children:(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '@/app/_components/root-client-wrapper'");e.code="MODULE_NOT_FOUND";throw e}()),{children:e})})]})}},327:()=>{},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1510:(e,r,t)=>{Promise.resolve().then(t.bind(t,3529))},1758:(e,r,t)=>{Promise.resolve().then(t.bind(t,2079))},2079:(e,r,t)=>{"use strict";t.r(r);t.d(r,{"default":()=>s});var o=t(5736);var n=t.n(o);const s=(0,o.registerClientReference)(function(){throw new Error("Attempted to call the default export of \"/home/project/app/verify-otp/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/project/app/verify-otp/page.tsx","default")},2695:()=>{},2879:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,889,23));Promise.resolve().then(t.t.bind(t,9921,23));Promise.resolve().then(t.t.bind(t,7849,23));Promise.resolve().then(t.t.bind(t,840,23));Promise.resolve().then(t.t.bind(t,7416,23));Promise.resolve().then(t.t.bind(t,6924,23));Promise.resolve().then(t.t.bind(t,8738,23));Promise.resolve().then(t.t.bind(t,8780,23))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3529:(e,r,t)=>{"use strict";t.r(r);t.d(r,{"default":()=>d});var o=t(1718);var n=t.n(o);var s=t(4743);var i=t.n(s);var a=t(7664);Object(function e(){var e=new Error("Cannot find module 'react-hook-form'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/components/ui/button'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/components/ui/input'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/components/ui/label'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/components/ui/card'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/hooks/use-toast'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '__barrel_optimize__?names=ArrowLeft,Loader2,Shield!=!lucide-react'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/lib/supabase/client'");e.code="MODULE_NOT_FOUND";throw e}());Object(function e(){var e=new Error("Cannot find module '@/lib/api'");e.code="MODULE_NOT_FOUND";throw e}());function c(){const[e,r]=(0,s.useState)(false);const[t,n]=(0,s.useState)(false);const[i,c]=(0,s.useState)(0);const d=(0,a.useRouter)();const l=(0,a.useSearchParams)();const{toast:u}=Object(function e(){var e=new Error("Cannot find module '@/hooks/use-toast'");e.code="MODULE_NOT_FOUND";throw e}())();const m=l.get("phone");const f=Object(function e(){var e=new Error("Cannot find module '@/lib/supabase/client'");e.code="MODULE_NOT_FOUND";throw e}())();const{register:p,handleSubmit:h,formState:{errors:_},watch:O}=Object(function e(){var e=new Error("Cannot find module 'react-hook-form'");e.code="MODULE_NOT_FOUND";throw e}())();const v=O("otp_code");process.env.__NEXT_PRIVATE_MINIMIZE_MACRO_FALSE&&(0,s.useEffect)(()=>{if(!m){d.push("/auth")}else{c(30)}},[m,d]);process.env.__NEXT_PRIVATE_MINIMIZE_MACRO_FALSE&&(0,s.useEffect)(()=>{if(v&&v.length===6&&!e){const e=setTimeout(()=>{h(b)()},300);return()=>clearTimeout(e)}},[v,e,h]);process.env.__NEXT_PRIVATE_MINIMIZE_MACRO_FALSE&&(0,s.useEffect)(()=>{if(i>0){const e=setTimeout(()=>{c(e=>e-1)},1e3);return()=>clearTimeout(e)}},[i]);const b=async e=>{if(!m)return;r(true);try{await Object(function e(){var e=new Error("Cannot find module '@/lib/api'");e.code="MODULE_NOT_FOUND";throw e}()).verifyOTP(m,e.otp_code);try{const{data:{session:e},error:r}=await f.auth.getSession();if(r){console.error("Session error:",r);throw new Error("Failed to get user session")}if(e?.user){const{data:r,error:t}=await f.from("profiles").select("user_id").eq("user_id",e.user.id).single();if(t&&t.code==="PGRST116"){const r=new Date().toISOString();const{error:t}=await f.from("profiles").insert({user_id:e.user.id,email:m,user_type:"user",full_name:"",avatar_url:"",created_at:r,updated_at:r}).single();if(t){console.error("Error creating user profile:",t);u({variant:"destructive",title:"Profile Creation Warning",description:"Account verified but profile setup incomplete. Please contact support if issues persist."})}else{console.log("✅ User profile created successfully")}}else if(t){console.error("Error checking user profile:",t);u({variant:"destructive",title:"Profile Check Warning",description:"Account verified but profile check failed. Please contact support if issues persist."})}else{console.log("✅ User profile already exists")}}else{console.warn("No user session found after OTP verification")}}catch(e){console.error("Profile handling error:",e);u({variant:"destructive",title:"Profile Setup Warning",description:"Account verified but profile setup incomplete. You can continue using the app."})}u({title:"Success",description:"Phone number verified successfully!"});d.push("/")}catch(e){u({variant:"destructive",title:"Verification Failed",description:e.message||"Invalid verification code"})}finally{r(false)}};const w=async()=>{if(!m||i>0)return;n(true);try{await Object(function e(){var e=new Error("Cannot find module '@/lib/api'");e.code="MODULE_NOT_FOUND";throw e}()).sendOTP(m);u({title:"OTP Resent",description:"A new verification code has been sent to your phone."});c(30)}catch(e){u({variant:"destructive",title:"Error",description:e.message||"Failed to resend OTP"})}finally{n(false)}};if(!m){return null}const N=i===0&&!t;return(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,o.jsxs)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/card'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"w-full max-w-md",children:[(0,o.jsxs)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/card'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"text-center",children:[(0,o.jsx)("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '__barrel_optimize__?names=ArrowLeft,Loader2,Shield!=!lucide-react'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"h-6 w-6 text-primary"})}),(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/card'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"text-2xl font-bold",children:"Verify Your Phone"}),(0,o.jsxs)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/card'");e.code="MODULE_NOT_FOUND";throw e}()),{children:["Enter the 6-digit code sent to"," ",(0,o.jsx)("span",{className:"font-medium",children:m})]})]}),(0,o.jsxs)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/card'");e.code="MODULE_NOT_FOUND";throw e}()),{children:[(0,o.jsxs)("form",{onSubmit:h(b),className:"space-y-4",children:[(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/label'");e.code="MODULE_NOT_FOUND";throw e}()),{htmlFor:"otp_code",children:"Verification Code"}),(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/input'");e.code="MODULE_NOT_FOUND";throw e}()),{id:"otp_code",type:"text",placeholder:"123456",maxLength:6,...p("otp_code",{required:"Verification code is required",pattern:{value:/^\d{6}$/,message:"Please enter a valid 6-digit code"}}),disabled:e,className:"text-center text-2xl tracking-widest font-mono",autoComplete:"one-time-code",autoFocus:true}),_.otp_code&&(0,o.jsx)("p",{className:"text-sm text-destructive",children:_.otp_code.message}),(0,o.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:v&&v.length===6&&!e?"Auto-submitting...":"Code will auto-submit when complete"})]}),(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/button'");e.code="MODULE_NOT_FOUND";throw e}()),{type:"submit",className:"w-full",disabled:e||!v||v.length!==6,children:e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '__barrel_optimize__?names=ArrowLeft,Loader2,Shield!=!lucide-react'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"mr-2 h-4 w-4 animate-spin"}),"Verifying..."]}):"Verify OTP"})]}),(0,o.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Didn't receive the code?"}),(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/button'");e.code="MODULE_NOT_FOUND";throw e}()),{variant:"outline",onClick:w,disabled:!N,className:"w-full",children:t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '__barrel_optimize__?names=ArrowLeft,Loader2,Shield!=!lucide-react'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"mr-2 h-4 w-4 animate-spin"}),"Resending..."]}):"Resend Code"}),i>0&&(0,o.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["You can resend the code in ",i,"s"]})]}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsxs)(Object(function e(){var e=new Error("Cannot find module '@/components/ui/button'");e.code="MODULE_NOT_FOUND";throw e}()),{variant:"ghost",onClick:()=>d.push("/auth"),className:"text-sm",children:[(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '__barrel_optimize__?names=ArrowLeft,Loader2,Shield!=!lucide-react'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"mr-2 h-4 w-4"}),"Back to Sign In"]})})]})]})]})})}function d(){return(0,o.jsx)(s.Suspense,{fallback:(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,o.jsx)(Object(function e(){var e=new Error("Cannot find module '__barrel_optimize__?names=ArrowLeft,Loader2,Shield!=!lucide-react'");e.code="MODULE_NOT_FOUND";throw e}()),{className:"h-8 w-8 animate-spin"})}),children:(0,o.jsx)(c,{})})}},3873:e=>{"use strict";e.exports=require("path")},4447:()=>{},6087:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,2163,23));Promise.resolve().then(t.t.bind(t,8655,23));Promise.resolve().then(t.t.bind(t,2947,23));Promise.resolve().then(t.t.bind(t,4226,23));Promise.resolve().then(t.t.bind(t,7558,23));Promise.resolve().then(t.t.bind(t,5514,23));Promise.resolve().then(t.t.bind(t,6096,23));Promise.resolve().then(t.t.bind(t,2418,23))},6397:(e,r,t)=>{"use strict";t.r(r);t.d(r,{GlobalError:()=>a.a,__next_app__:()=>w,pages:()=>O,routeModule:()=>N,tree:()=>_});var o=t(3700);var n=t.n(o);var s=t(6123);var i=t(2947);var a=t.n(i);var c=t(1020);var d=t.n(c);var l={};for(const e in c)if(["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)<0)l[e]=()=>c[e];t.d(r,l);const u=()=>Promise.resolve().then(t.bind(t,288));const m=()=>Promise.resolve().then(t.t.bind(t,1809,23));const f=()=>Promise.resolve().then(t.t.bind(t,8796,23));const p=()=>Promise.resolve().then(t.t.bind(t,3837,23));const h=()=>Promise.resolve().then(t.bind(t,2079));const _={children:["",{children:["verify-otp",{children:["__PAGE__",{},{page:[h,"/home/project/app/verify-otp/page.tsx"]}]},{}]},{"layout":[u,"/home/project/app/layout.tsx"],"not-found":[m,"next/dist/client/components/not-found-error"],"forbidden":[f,"next/dist/client/components/forbidden-error"],"unauthorized":[p,"next/dist/client/components/unauthorized-error"]}]}.children;const O=["/home/project/app/verify-otp/page.tsx"];const v=t;const b=()=>Promise.resolve();const w={require:v,loadChunk:b};const N=new o.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/verify-otp/page",pathname:"/verify-otp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:_}})},7664:(e,r,t)=>{"use strict";var o=t(6596);var n=t.n(o);if(t.o(o,"useParams"))t.d(r,{useParams:function(){return o.useParams}});if(t.o(o,"useRouter"))t.d(r,{useRouter:function(){return o.useRouter}});if(t.o(o,"useSearchParams"))t.d(r,{useSearchParams:function(){return o.useSearchParams}})},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e);var o=r.X(0,[987],()=>t(6397));module.exports=o})();